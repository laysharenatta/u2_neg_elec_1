<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Catálogo de Productos</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

<div class="container mt-5">

    <h2 class="mb-4">Catálogo de Productos</h2>


    <div class="card mb-4 shadow">
        <div class="card-body">
            <h5>Agregar Producto</h5>

            <form id="formProducto">

                <input type="text" id="nombre" class="form-control mb-2" placeholder="Nombre" required>

                <input type="text" id="categoria" class="form-control mb-2" placeholder="Categoría" required>

                <input type="number" id="stock_actual" class="form-control mb-2" placeholder="Stock Actual" required>

                <input type="number" id="stock_minimo" class="form-control mb-2" placeholder="Stock Mínimo" required>

                <input type="number" step="0.01" id="costo_unitario" class="form-control mb-2" placeholder="Costo Unitario" required>

                <select id="proveedor_id" class="form-control mb-2" required>
                    <option value="">Seleccionar proveedor</option>
                </select>

                <button type="submit" class="btn btn-success">Guardar</button>

            </form>
        </div>
    </div>

    <div class="row" id="listaProductos"></div>

</div>

<script>

document.addEventListener("DOMContentLoaded", function () {
    cargarProductos();
    cargarProveedores();
});



function cargarProductos() {
    fetch("http://127.0.0.1:8000/api/productos")
        .then(response => response.json())
        .then(data => {
            let contenedor = document.getElementById("listaProductos");
            contenedor.innerHTML = "";

            data.forEach(producto => {
                contenedor.innerHTML += `
                    <div class="col-md-4 mb-4">
                        <div class="card shadow">
                            <div class="card-body">
                                <h5 class="card-title">${producto.nombre}</h5>
                                <p><strong>Categoría:</strong> ${producto.categoria}</p>
                                <p><strong>Costo:</strong> $${producto.costo_unitario}</p>
                                <p>Stock Actual: ${producto.stock_actual}</p>
                                <p>Stock Mínimo: ${producto.stock_minimo}</p>
                                <p>Proveedor ID: ${producto.proveedor_id}</p>

                                <button onclick="editarProducto(${producto.id})" class="btn btn-warning btn-sm">Editar</button>
                                <button onclick="eliminarProducto(${producto.id})" class="btn btn-danger btn-sm">Eliminar</button>
                            </div>
                        </div>
                    </div>
                `;
            });
        })
        .catch(error => console.error("Error:", error));
}



function cargarProveedores() {
    fetch("http://127.0.0.1:8000/api/proveedores")
        .then(response => response.json())
        .then(data => {
            let select = document.getElementById("proveedor_id");
            select.innerHTML = '<option value="">Seleccionar proveedor</option>';

            data.forEach(proveedor => {
                select.innerHTML += `
                    <option value="${proveedor.id}">
                        ${proveedor.nombre}
                    </option>
                `;
            });
        });
}



document.getElementById("formProducto").addEventListener("submit", function(e) {

    e.preventDefault();

    fetch("http://127.0.0.1:8000/api/productos", {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify({
            nombre: document.getElementById("nombre").value,
            categoria: document.getElementById("categoria").value,
            stock_actual: document.getElementById("stock_actual").value,
            stock_minimo: document.getElementById("stock_minimo").value,
            proveedor_id: document.getElementById("proveedor_id").value,
            costo_unitario: document.getElementById("costo_unitario").value
        })
    })
    .then(response => response.json())
    .then(data => {
        alert("Producto creado correctamente");
        document.getElementById("formProducto").reset();
        cargarProductos();
    })
    .catch(error => console.error("Error:", error));
});



function eliminarProducto(id) {

    if (confirm("¿Seguro que quieres eliminar este producto?")) {

        fetch("http://127.0.0.1:8000/api/productos", {
            method: "DELETE",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({ id: id })
        })
        .then(response => response.json())
        .then(data => {
            alert("Producto eliminado");
            cargarProductos();
        })
        .catch(error => console.error("Error:", error));
    }
}



function editarProducto(id) {

    const nuevoNombre = prompt("Nuevo nombre:");
    const nuevaCategoria = prompt("Nueva categoría:");

    fetch("http://127.0.0.1:8000/api/productos", {
        method: "PUT",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify({
            id: id,
            nombre: nuevoNombre,
            categoria: nuevaCategoria
        })
    })
    .then(response => response.json())
    .then(data => {
        alert("Producto actualizado");
        cargarProductos();
    })
    .catch(error => console.error("Error:", error));
}

</script>

</body>
</html>
<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Gesti√≥n de Pedidos SCM</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body {
    background: #0f172a;
    color: white;
}

.card-dark {
    background: #1e293b;
    border-radius: 15px;
    border: none;
}

.btn-generate {
    background: linear-gradient(135deg, #2563eb, #1e40af);
    border: none;
}

.table {
    color: white;
}

select {
    background: #1e293b !important;
    color: white !important;
    border: 1px solid #334155 !important;
}
</style>

</head>
<body>

<div class="container mt-5">

<h2 class="text-center mb-4"> Gesti√≥n de Pedidos</h2>

<div class="text-center mb-4">
    <button onclick="generarPedido()" class="btn btn-generate btn-lg">
        Generar Pedido Autom√°tico
    </button>
</div>

<div class="card card-dark p-4 shadow">
    <h5>Lista de Pedidos</h5>

    <table class="table table-dark table-hover mt-3">
        <thead>
            <tr>
                <th>#</th>
                <th>Producto</th>
                <th>Cantidad</th>
                <th>Estado</th>
            </tr>
        </thead>
        <tbody id="tablaPedidos">
        </tbody>
    </table>
</div>

</div>

<script>

const API = "http://127.0.0.1:8000/api";
let pedidos = [];
let contadorPedido = 1;

async function generarPedido() {

    const res = await fetch(`${API}/productos`);
    const productos = await res.json();

    const productosBajoStock = productos.filter(p => p.stock_actual <= p.stock_minimo);

    if(productosBajoStock.length === 0) {
        alert("No hay productos bajo stock üéâ");
        return;
    }

    productosBajoStock.forEach(producto => {

        pedidos.push({
            id: contadorPedido++,
            producto: producto.nombre,
            cantidad: (producto.stock_minimo * 2) - producto.stock_actual,
            estado: "Pendiente"
        });

    });

    renderPedidos();
}

function renderPedidos() {

    const tabla = document.getElementById("tablaPedidos");
    tabla.innerHTML = "";

    pedidos.forEach(pedido => {

        tabla.innerHTML += `
            <tr>
                <td>${pedido.id}</td>
                <td>${pedido.producto}</td>
                <td>${pedido.cantidad}</td>
                <td>
                    <select onchange="cambiarEstado(${pedido.id}, this.value)">
                        <option ${pedido.estado=="Pendiente"?"selected":""}>Pendiente</option>
                        <option ${pedido.estado=="Enviado"?"selected":""}>Enviado</option>
                        <option ${pedido.estado=="Recibido"?"selected":""}>Recibido</option>
                    </select>
                </td>
            </tr>
        `;
    });
}

function cambiarEstado(id, nuevoEstado) {

    const pedido = pedidos.find(p => p.id === id);
    pedido.estado = nuevoEstado;

    renderPedidos();
}

</script>

</body>
</html>
<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Tailwind v4 -->
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>

  <title>Honey Pop - CRM Clientes</title>

  <link href="https://fonts.googleapis.com/css2?family=Homemade+Apple&family=Pacifico&display=swap"
    rel="stylesheet" />

  <style>
    .glass {
      background: rgba(255, 255, 255, 0.08);
      backdrop-filter: blur(10px) saturate(150%);
      -webkit-backdrop-filter: blur(10px) saturate(150%);
    }

    .bg-accent {
      background: linear-gradient(90deg, #F266B3 0%, #F2884B 100%);
    }
  </style>
</head>

<body class="min-h-screen bg-gradient-to-b from-gray-100 to-white font-sans text-gray-800 p-10">

  <!-- CONTENEDOR PRINCIPAL -->
  <div class="max-w-6xl mx-auto glass p-8 rounded-3xl shadow-xl">

    <!-- T√çTULO -->
    <h1 class="text-3xl font-bold mb-8 text-gray-800">
      Gesti√≥n de Clientes üçØ (CRM)
    </h1>

    <!-- FORMULARIO -->
    <h2 id="tituloForm" class="text-xl font-semibold mb-4">
      Registrar Cliente
    </h2>

    <form id="formCliente" class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">

      <!-- ID oculto -->
      <input type="hidden" id="clienteId">

      <input id="nombre" type="text" placeholder="Nombre completo"
        class="border p-3 rounded-xl focus:ring focus:ring-pink-300" required>

      <input id="correo" type="email" placeholder="Correo"
        class="border p-3 rounded-xl focus:ring focus:ring-orange-300" required>

      <input id="telefono" type="text" placeholder="Tel√©fono"
        class="border p-3 rounded-xl focus:ring focus:ring-green-300">

      <input id="empresa" type="text" placeholder="Empresa"
        class="border p-3 rounded-xl focus:ring focus:ring-blue-300">

      <select id="estado"
        class="border p-3 rounded-xl focus:ring focus:ring-purple-300">
        <option value="1">Activo</option>
        <option value="0">Inactivo</option>
      </select>

      <!-- BOT√ìN GUARDAR -->
      <button type="submit"
        class="bg-accent text-white font-semibold py-3 rounded-xl shadow hover:scale-105 transition col-span-1 md:col-span-2">
        Guardar Cliente
      </button>

      <!-- BOT√ìN CANCELAR -->
      <button type="button" id="cancelarEdicion"
        class="hidden bg-gray-400 hover:bg-gray-500 text-white font-semibold py-3 rounded-xl col-span-1 md:col-span-2">
        Cancelar Edici√≥n
      </button>

    </form>

    <!-- BUSCADOR + FILTRO -->
    <div class="flex flex-col md:flex-row gap-4 mb-6">

      <input id="busqueda" type="text"
        placeholder="Buscar cliente..."
        class="w-full border p-3 rounded-xl focus:ring focus:ring-pink-300">

      <select id="filtroEstado"
        class="border p-3 rounded-xl focus:ring focus:ring-orange-300">
        <option value="">Todos</option>
        <option value="1">Activos</option>
        <option value="0">Inactivos</option>
      </select>

    </div>

    <!-- TABLA -->
    <div class="overflow-x-auto rounded-2xl shadow-lg">
      <table class="w-full text-sm text-center bg-white rounded-xl overflow-hidden">
        <thead class="bg-accent text-white">
          <tr>
            <th class="p-3">Nombre</th>
            <th class="p-3">Correo</th>
            <th class="p-3">Empresa</th>
            <th class="p-3">Estado</th>
            <th class="p-3">Acciones</th>
          </tr>
        </thead>

        <tbody id="tablaClientes" class="divide-y"></tbody>
      </table>
    </div>

  </div>

  <!-- SCRIPT -->
  <script>
    const API_URL = "http://127.0.0.1:8000/api/clients";
    let clientes = [];

    // ‚úÖ GET clientes
    async function cargarClientes() {
      const res = await fetch(API_URL);
      clientes = await res.json();
      mostrarClientes(clientes);
    }

    // ‚úÖ Mostrar tabla
    function mostrarClientes(lista) {
      const tabla = document.getElementById("tablaClientes");
      tabla.innerHTML = "";

      lista.forEach(c => {
        tabla.innerHTML += `
          <tr class="hover:bg-gray-50">
            <td class="p-3 font-medium">${c.nombre}</td>
            <td class="p-3">${c.correo}</td>
            <td class="p-3">${c.empresa ?? ""}</td>

            <td class="p-3">
              <span class="px-3 py-1 rounded-full text-white ${c.estado ? "bg-green-500" : "bg-gray-500"}">
                ${c.estado ? "Activo" : "Inactivo"}
              </span>
            </td>

            <td class="p-3 flex justify-center gap-2">

              <button onclick="editarCliente(${c.id})"
                class="px-3 py-1 rounded-lg bg-orange-500 text-white text-xs hover:opacity-80">
                Editar
              </button>

              <button onclick="eliminarCliente(${c.id})"
                class="px-3 py-1 rounded-lg bg-red-500 text-white text-xs hover:opacity-80">
                Eliminar
              </button>

            </td>
          </tr>
        `;
      });
    }

    // ‚úÖ POST o PUT cliente
    document.getElementById("formCliente").addEventListener("submit", async (e) => {
      e.preventDefault();

      const id = clienteId.value;

      const cliente = {
        nombre: nombre.value,
        correo: correo.value,
        telefono: telefono.value,
        empresa: empresa.value,
        estado: estado.value == "1"
      };

      if (id) {
        await fetch(`${API_URL}/${id}`, {
          method: "PUT",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(cliente)
        });

        alert("Cliente actualizado correctamente");

      } else {
        await fetch(API_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(cliente)
        });

        alert("Cliente registrado correctamente");
      }

      resetFormulario();
      cargarClientes();
    });

    // ‚úÖ Eliminar cliente
    async function eliminarCliente(id) {
      if (!confirm("¬øSeguro que deseas eliminar este cliente?")) return;

      await fetch(`${API_URL}/${id}`, {
        method: "DELETE"
      });

      alert("Cliente eliminado correctamente");
      cargarClientes();
    }

    // ‚úÖ Editar cliente
    function editarCliente(id) {
      const cliente = clientes.find(c => c.id === id);

      clienteId.value = cliente.id;
      nombre.value = cliente.nombre;
      correo.value = cliente.correo;
      telefono.value = cliente.telefono ?? "";
      empresa.value = cliente.empresa ?? "";
      estado.value = cliente.estado ? "1" : "0";

      tituloForm.innerText = "Editar Cliente";
      cancelarEdicion.classList.remove("hidden");
    }

    // ‚úÖ Cancelar edici√≥n
    cancelarEdicion.addEventListener("click", resetFormulario);

    function resetFormulario() {
      formCliente.reset();
      clienteId.value = "";
      tituloForm.innerText = "Registrar Cliente";
      cancelarEdicion.classList.add("hidden");
    }

    // ‚úÖ Buscar + filtrar
    function aplicarFiltros() {
      const texto = busqueda.value.toLowerCase();
      const filtro = filtroEstado.value;

      let filtrados = clientes.filter(c =>
        c.nombre.toLowerCase().includes(texto) ||
        c.correo.toLowerCase().includes(texto)
      );

      if (filtro !== "") {
        filtrados = filtrados.filter(c =>
          String(Number(c.estado)) === filtro
        );
      }

      mostrarClientes(filtrados);
    }

    busqueda.addEventListener("input", aplicarFiltros);
    filtroEstado.addEventListener("change", aplicarFiltros);

    // ‚úÖ Inicializar
    cargarClientes();
  </script>

</body>
</html>
